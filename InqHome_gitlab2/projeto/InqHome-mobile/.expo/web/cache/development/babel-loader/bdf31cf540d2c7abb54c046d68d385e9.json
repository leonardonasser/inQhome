{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"C:\\\\Users\\\\User\\\\Desktop\\\\ADS\\\\InqHome_gitlab2\\\\projeto\\\\InqHome-mobile\\\\node_modules\\\\expo-image-picker-multiple\\\\src\\\\ImageBrowser.js\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport View from \"react-native-web/dist/exports/View\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport ActivityIndicator from \"react-native-web/dist/exports/ActivityIndicator\";\nimport * as ScreenOrientation from 'expo-screen-orientation';\nimport * as MediaLibrary from 'expo-media-library';\nimport * as Permissions from 'expo-permissions';\nimport ImageTile from \"./ImageTile\";\n\nvar _Dimensions$get = Dimensions.get('window'),\n    width = _Dimensions$get.width;\n\nvar ImageBrowser = function (_React$Component) {\n  _inherits(ImageBrowser, _React$Component);\n\n  var _super = _createSuper(ImageBrowser);\n\n  function ImageBrowser() {\n    var _this;\n\n    _classCallCheck(this, ImageBrowser);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      hasCameraPermission: null,\n      hasCameraRollPermission: null,\n      numColumns: null,\n      photos: [],\n      selected: [],\n      isEmpty: false,\n      after: null,\n      hasNextPage: true\n    };\n\n    _this.getPermissionsAsync = function _callee() {\n      var _await$Permissions$as, camera, _await$Permissions$as2, cameraRoll;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(Permissions.askAsync(Permissions.CAMERA));\n\n            case 2:\n              _await$Permissions$as = _context.sent;\n              camera = _await$Permissions$as.status;\n              _context.next = 6;\n              return _regeneratorRuntime.awrap(Permissions.askAsync(Permissions.MEDIA_LIBRARY));\n\n            case 6:\n              _await$Permissions$as2 = _context.sent;\n              cameraRoll = _await$Permissions$as2.status;\n\n              _this.setState({\n                hasCameraPermission: camera === 'granted',\n                hasCameraRollPermission: cameraRoll === 'granted'\n              });\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.onOrientationChange = function (_ref) {\n      var orientationInfo = _ref.orientationInfo;\n      ScreenOrientation.removeOrientationChangeListeners();\n      ScreenOrientation.addOrientationChangeListener(_this.onOrientationChange);\n\n      var numColumns = _this.getNumColumns(orientationInfo.orientation);\n\n      _this.setState({\n        numColumns: numColumns\n      });\n    };\n\n    _this.getNumColumns = function (orientation) {\n      var _ScreenOrientation$Or = ScreenOrientation.Orientation,\n          PORTRAIT_UP = _ScreenOrientation$Or.PORTRAIT_UP,\n          PORTRAIT_DOWN = _ScreenOrientation$Or.PORTRAIT_DOWN;\n      var isPortrait = orientation === PORTRAIT_UP || orientation === PORTRAIT_DOWN;\n      return isPortrait ? 4 : 7;\n    };\n\n    _this.selectImage = function (index) {\n      var newSelected = Array.from(_this.state.selected);\n\n      if (newSelected.indexOf(index) === -1) {\n        newSelected.push(index);\n      } else {\n        var deleteIndex = newSelected.indexOf(index);\n        newSelected.splice(deleteIndex, 1);\n      }\n\n      if (newSelected.length > _this.props.max) return;\n      if (!newSelected) newSelected = [];\n\n      _this.setState({\n        selected: newSelected\n      }, function () {\n        _this.props.onChange(newSelected.length, function () {\n          return _this.prepareCallback();\n        });\n      });\n    };\n\n    _this.getPhotos = function () {\n      var params = {\n        first: _this.props.loadCount,\n        mediaType: _this.props.mediaType,\n        sortBy: [MediaLibrary.SortBy.creationTime]\n      };\n      if (_this.state.after) params.after = _this.state.after;\n      if (!_this.state.hasNextPage) return;\n      MediaLibrary.getAssetsAsync(params).then(_this.processPhotos);\n    };\n\n    _this.processPhotos = function (data) {\n      if (data.totalCount) {\n        if (_this.state.after === data.endCursor) return;\n        var uris = data.assets;\n\n        _this.setState({\n          photos: [].concat(_toConsumableArray(_this.state.photos), _toConsumableArray(uris)),\n          after: data.endCursor,\n          hasNextPage: data.hasNextPage\n        });\n      } else {\n        _this.setState({\n          isEmpty: true\n        });\n      }\n    };\n\n    _this.getItemLayout = function (data, index) {\n      var length = width / 4;\n      return {\n        length: length,\n        offset: length * index,\n        index: index\n      };\n    };\n\n    _this.renderImageTile = function (_ref2) {\n      var item = _ref2.item,\n          index = _ref2.index;\n      var selected = _this.state.selected.indexOf(index) !== -1;\n      var selectedItemNumber = _this.state.selected.indexOf(index) + 1;\n      return React.createElement(ImageTile, {\n        selectedItemNumber: selectedItemNumber,\n        item: item,\n        index: index,\n        selected: selected,\n        selectImage: _this.selectImage,\n        renderSelectedComponent: _this.props.renderSelectedComponent,\n        renderExtraComponent: _this.props.renderExtraComponent,\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 7\n        }\n      });\n    };\n\n    _this.renderPreloader = function () {\n      return _this.props.preloaderComponent;\n    };\n\n    _this.renderEmptyStay = function () {\n      return _this.props.emptyStayComponent;\n    };\n\n    return _this;\n  }\n\n  _createClass(ImageBrowser, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var orientation, numColumns;\n      return _regeneratorRuntime.async(function componentDidMount$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(this.getPermissionsAsync());\n\n            case 2:\n              ScreenOrientation.addOrientationChangeListener(this.onOrientationChange);\n              _context2.next = 5;\n              return _regeneratorRuntime.awrap(ScreenOrientation.getOrientationAsync());\n\n            case 5:\n              orientation = _context2.sent;\n              numColumns = this.getNumColumns(orientation);\n              this.setState({\n                numColumns: numColumns\n              });\n              this.getPhotos();\n\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"prepareCallback\",\n    value: function prepareCallback() {\n      var loadCompleteMetadata = this.props.loadCompleteMetadata;\n      var _this$state = this.state,\n          selected = _this$state.selected,\n          photos = _this$state.photos;\n      var selectedPhotos = selected.map(function (i) {\n        return photos[i];\n      });\n\n      if (!loadCompleteMetadata) {\n        this.props.callback(Promise.all(selectedPhotos));\n      } else {\n        var assetsInfo = Promise.all(selectedPhotos.map(function (i) {\n          return MediaLibrary.getAssetInfoAsync(i);\n        }));\n        this.props.callback(assetsInfo);\n      }\n    }\n  }, {\n    key: \"renderImages\",\n    value: function renderImages() {\n      var _this2 = this;\n\n      return React.createElement(FlatList, {\n        data: this.state.photos,\n        numColumns: this.state.numColumns,\n        key: this.state.numColumns,\n        renderItem: this.renderImageTile,\n        keyExtractor: function keyExtractor(_, index) {\n          return index;\n        },\n        onEndReached: function onEndReached() {\n          return _this2.getPhotos();\n        },\n        onEndReachedThreshold: 0.5,\n        ListEmptyComponent: this.state.isEmpty ? this.renderEmptyStay() : this.renderPreloader(),\n        initialNumToRender: 24,\n        getItemLayout: this.getItemLayout,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 7\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var hasCameraPermission = this.state.hasCameraPermission;\n      if (!hasCameraPermission) return this.props.noCameraPermissionComponent || null;\n      return React.createElement(View, {\n        style: styles.container,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 7\n        }\n      }, this.renderImages());\n    }\n  }]);\n\n  return ImageBrowser;\n}(React.Component);\n\nImageBrowser.defaultProps = {\n  loadCompleteMetadata: false,\n  loadCount: 50,\n  emptyStayComponent: null,\n  preloaderComponent: React.createElement(ActivityIndicator, {\n    size: \"large\",\n    __self: ImageBrowser,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 21,\n      columnNumber: 25\n    }\n  }),\n  mediaType: [MediaLibrary.MediaType.photo]\n};\nexport { ImageBrowser as default };\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1\n  }\n});","map":{"version":3,"sources":["C:/Users/User/Desktop/ADS/InqHome_gitlab2/projeto/InqHome-mobile/node_modules/expo-image-picker-multiple/src/ImageBrowser.js"],"names":["React","ScreenOrientation","MediaLibrary","Permissions","ImageTile","Dimensions","get","width","ImageBrowser","state","hasCameraPermission","hasCameraRollPermission","numColumns","photos","selected","isEmpty","after","hasNextPage","getPermissionsAsync","askAsync","CAMERA","camera","status","MEDIA_LIBRARY","cameraRoll","setState","onOrientationChange","orientationInfo","removeOrientationChangeListeners","addOrientationChangeListener","getNumColumns","orientation","Orientation","PORTRAIT_UP","PORTRAIT_DOWN","isPortrait","selectImage","index","newSelected","Array","from","indexOf","push","deleteIndex","splice","length","props","max","onChange","prepareCallback","getPhotos","params","first","loadCount","mediaType","sortBy","SortBy","creationTime","getAssetsAsync","then","processPhotos","data","totalCount","endCursor","uris","assets","getItemLayout","offset","renderImageTile","item","selectedItemNumber","renderSelectedComponent","renderExtraComponent","renderPreloader","preloaderComponent","renderEmptyStay","emptyStayComponent","getOrientationAsync","loadCompleteMetadata","selectedPhotos","map","i","callback","Promise","all","assetsInfo","getAssetInfoAsync","_","noCameraPermissionComponent","styles","container","renderImages","Component","defaultProps","MediaType","photo","StyleSheet","create","flex"],"mappings":"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","sourcesContent":["import React from 'react';\nimport {\n  StyleSheet,\n  View,\n  FlatList,\n  Dimensions,\n  ActivityIndicator,\n} from 'react-native'\nimport * as ScreenOrientation from 'expo-screen-orientation';\nimport * as MediaLibrary from 'expo-media-library'\nimport * as Permissions from 'expo-permissions'\nimport ImageTile from './ImageTile'\n\nconst {width} = Dimensions.get('window');\n\nexport default class ImageBrowser extends React.Component {\n  static defaultProps = {\n    loadCompleteMetadata: false,\n    loadCount: 50,\n    emptyStayComponent: null,\n    preloaderComponent: <ActivityIndicator size='large'/>,\n    mediaType: [MediaLibrary.MediaType.photo]\n  }\n\n  state = {\n    hasCameraPermission: null,\n    hasCameraRollPermission: null,\n    numColumns: null,\n    photos: [],\n    selected: [],\n    isEmpty: false,\n    after: null,\n    hasNextPage: true\n  }\n\n  async componentDidMount() {\n    await this.getPermissionsAsync();\n    ScreenOrientation.addOrientationChangeListener(this.onOrientationChange);\n    const orientation = await ScreenOrientation.getOrientationAsync();\n    const numColumns = this.getNumColumns(orientation);\n    this.setState({numColumns});\n    this.getPhotos();\n  }\n\n  getPermissionsAsync = async () => {\n    const {status: camera} = await Permissions.askAsync(Permissions.CAMERA);\n    const {status: cameraRoll} = await Permissions.askAsync(Permissions.MEDIA_LIBRARY);\n    this.setState({\n      hasCameraPermission: camera === 'granted',\n      hasCameraRollPermission: cameraRoll === 'granted'\n    });\n  }\n\n  onOrientationChange = ({orientationInfo}) => {\n    ScreenOrientation.removeOrientationChangeListeners();\n    ScreenOrientation.addOrientationChangeListener(this.onOrientationChange);\n    const numColumns = this.getNumColumns(orientationInfo.orientation);\n    this.setState({numColumns});\n  }\n\n  getNumColumns = orientation => {\n    const {PORTRAIT_UP, PORTRAIT_DOWN} = ScreenOrientation.Orientation;\n    const isPortrait = orientation === PORTRAIT_UP || orientation === PORTRAIT_DOWN;\n    return isPortrait ? 4 : 7;\n  }\n\n  selectImage = (index) => {\n    let newSelected = Array.from(this.state.selected);\n    if (newSelected.indexOf(index) === -1) {\n      newSelected.push(index);\n    } else {\n      const deleteIndex = newSelected.indexOf(index);\n      newSelected.splice(deleteIndex, 1);\n    }\n    if (newSelected.length > this.props.max) return;\n    if (!newSelected) newSelected = []; \n    this.setState({selected: newSelected}, () =>{\n      this.props.onChange(newSelected.length, () => this.prepareCallback());\n    });\n  }\n\n  getPhotos = () => {\n    const params = {\n      first: this.props.loadCount,\n      mediaType: this.props.mediaType,\n      sortBy: [MediaLibrary.SortBy.creationTime]\n    };\n    if (this.state.after) params.after = this.state.after;\n    if (!this.state.hasNextPage) return;\n    MediaLibrary\n      .getAssetsAsync(params)\n      .then(this.processPhotos);\n  }\n\n  processPhotos = (data) => {\n    if (data.totalCount) {\n      if (this.state.after === data.endCursor) return;\n      const uris = data.assets;\n      this.setState({\n        photos: [...this.state.photos, ...uris],\n        after: data.endCursor,\n        hasNextPage: data.hasNextPage\n      });\n    } else {\n      this.setState({isEmpty: true});\n    }\n  }\n\n  getItemLayout = (data, index) => {\n    const length = width / 4;\n    return {length, offset: length * index, index};\n  }\n\n  prepareCallback() {\n    const { loadCompleteMetadata } = this.props;\n    const { selected, photos } = this.state;\n    const selectedPhotos = selected.map(i => photos[i]);\n    if (!loadCompleteMetadata){\n      this.props.callback(Promise.all(selectedPhotos));\n    } else {\n      const assetsInfo = Promise.all(selectedPhotos.map(i => MediaLibrary.getAssetInfoAsync(i)));\n      this.props.callback(assetsInfo);\n    }\n  }\n\n  renderImageTile = ({item, index}) => {\n    const selected = this.state.selected.indexOf(index) !== -1;\n    const selectedItemNumber = this.state.selected.indexOf(index) + 1;\n    return (\n      <ImageTile\n        selectedItemNumber={selectedItemNumber}\n        item={item}\n        index={index}\n        selected={selected}\n        selectImage={this.selectImage}\n        renderSelectedComponent={this.props.renderSelectedComponent}\n        renderExtraComponent={this.props.renderExtraComponent}\n      />\n    );\n  }\n\n  renderPreloader = () => this.props.preloaderComponent;\n\n  renderEmptyStay = () => this.props.emptyStayComponent;\n\n  renderImages() {\n    return (\n      <FlatList\n        data={this.state.photos}\n        numColumns={this.state.numColumns}\n        key={this.state.numColumns}\n        renderItem={this.renderImageTile}\n        keyExtractor={(_, index) => index}\n        onEndReached={() => this.getPhotos()}\n        onEndReachedThreshold={0.5}\n        ListEmptyComponent={this.state.isEmpty ? this.renderEmptyStay() : this.renderPreloader()}\n        initialNumToRender={24}\n        getItemLayout={this.getItemLayout}\n      />\n    );\n  }\n\n  render() {\n    const {hasCameraPermission} = this.state;\n    if (!hasCameraPermission) return this.props.noCameraPermissionComponent || null;\n\n    return (\n      <View style={styles.container}>\n        {this.renderImages()}\n      </View>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n});\n"]},"metadata":{},"sourceType":"module"}